<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œê¸€ CSV ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ í‘œì¤€ êµ¬í˜„ ê°€ì´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.8;
            color: #333;
            background: #f5f7fa;
            padding: 0;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            background: white;
        }
        
        .toc {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 40px;
            border-left: 4px solid #667eea;
        }
        
        .toc h2 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        
        .toc li {
            padding: 8px 0;
        }
        
        .toc a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        h2 {
            font-size: 28px;
            color: #2c3e50;
            margin: 50px 0 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        h3 {
            font-size: 22px;
            color: #34495e;
            margin: 35px 0 15px;
            padding-left: 10px;
            border-left: 4px solid #667eea;
        }
        
        h4 {
            font-size: 18px;
            color: #546e7a;
            margin: 25px 0 10px;
        }
        
        p {
            margin-bottom: 15px;
            color: #555;
        }
        
        .alert {
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid;
        }
        
        .alert-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        
        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        
        .alert-danger {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        
        .alert-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            position: relative;
        }
        
        .code-block::before {
            content: 'PHP';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .code-block.javascript::before {
            content: 'JavaScript';
            background: #f0db4f;
            color: #323330;
        }
        
        .code-block.html::before {
            content: 'HTML';
            background: #e34c26;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: left;
            border: 1px solid #e0e0e0;
        }
        
        .comparison-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .comparison-table tr:hover {
            background: #e3f2fd;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 5px;
        }
        
        .badge-success {
            background: #28a745;
            color: white;
        }
        
        .badge-danger {
            background: #dc3545;
            color: white;
        }
        
        .badge-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .checklist {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .checklist h4 {
            color: #28a745;
            margin-bottom: 15px;
        }
        
        .checklist ul {
            list-style: none;
            padding-left: 0;
        }
        
        .checklist li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
        }
        
        .checklist li::before {
            content: "âœ…";
            position: absolute;
            left: 0;
        }
        
        .step-box {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }
        
        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
            text-align: center;
            color: #999;
        }
        
        @media print {
            body {
                background: white;
            }
            
            .container {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“‹ í•œê¸€ CSV ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ í‘œì¤€ êµ¬í˜„ ê°€ì´ë“œ</h1>
        <p>PHP í™˜ê²½ì—ì„œ Excel ì™„ë²½ í˜¸í™˜ì„ ìœ„í•œ UTF-8 BOM ë°©ì‹ êµ¬í˜„</p>
    </div>
    
    <div class="container">
        <div class="toc">
            <h2>ğŸ“‘ ëª©ì°¨</h2>
            <ul>
                <li><a href="#problem">1. í•œê¸€ ì¸ì½”ë”© ë¬¸ì œì˜ ì›ì¸</a></li>
                <li><a href="#solution-overview">2. í•´ê²° ë°©ë²• ê°œìš”</a></li>
                <li><a href="#upload">3. CSV ì—…ë¡œë“œ êµ¬í˜„ (í•œê¸€ â†’ UTF-8)</a></li>
                <li><a href="#download">4. CSV ë‹¤ìš´ë¡œë“œ êµ¬í˜„ (UTF-8 BOM)</a></li>
                <li><a href="#template">5. í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ êµ¬í˜„</a></li>
                <li><a href="#comparison">6. ì˜¬ë°”ë¥¸ ë°©ì‹ vs ì˜ëª»ëœ ë°©ì‹ ë¹„êµ</a></li>
                <li><a href="#troubleshooting">7. ë¬¸ì œ í•´ê²° (Troubleshooting)</a></li>
                <li><a href="#checklist">8. êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸</a></li>
            </ul>
        </div>

        <!-- 1. í•œê¸€ ì¸ì½”ë”© ë¬¸ì œì˜ ì›ì¸ -->
        <h2 id="problem">1. í•œê¸€ ì¸ì½”ë”© ë¬¸ì œì˜ ì›ì¸</h2>
        
        <div class="alert alert-danger">
            <strong>âš ï¸ ì¼ë°˜ì ì¸ ë¬¸ì œ ìƒí™©</strong><br>
            â€¢ CSV ë‹¤ìš´ë¡œë“œ ì‹œ Excelì—ì„œ í•œê¸€ì´ "Ã¬ Ã­Ã¬Â½Ã«"ì²˜ëŸ¼ ê¹¨ì ¸ì„œ í‘œì‹œë¨<br>
            â€¢ ë©”ëª¨ì¥ì—ì„œëŠ” ì •ìƒì´ì§€ë§Œ Excelì—ì„œë§Œ ê¹¨ì§<br>
            â€¢ CSV ì—…ë¡œë“œ ì‹œ EUC-KR ì¸ì½”ë”© íŒŒì¼ì˜ í•œê¸€ì´ ì²˜ë¦¬ ì•ˆë¨
        </div>

        <h3>1.1 ê·¼ë³¸ ì›ì¸</h3>
        <p><strong>Excelì€ ê¸°ë³¸ì ìœ¼ë¡œ CSV íŒŒì¼ì„ ì‹œìŠ¤í…œ ê¸°ë³¸ ì¸ì½”ë”©ìœ¼ë¡œ ì—´ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤.</strong> í•œêµ­ Windowsì—ì„œëŠ” CP949(EUC-KR)ê°€ ê¸°ë³¸ì´ë¯€ë¡œ, UTF-8ë¡œ ì €ì¥ëœ CSVëŠ” ê¹¨ì ¸ì„œ ë³´ì…ë‹ˆë‹¤.</p>

        <h4>í•´ê²°ì±…: UTF-8 BOM (Byte Order Mark)</h4>
        <p>íŒŒì¼ ì‹œì‘ ë¶€ë¶„ì— <code>0xEF 0xBB 0xBF</code> 3ë°”ì´íŠ¸ë¥¼ ì¶”ê°€í•˜ë©´, Excelì´ ìë™ìœ¼ë¡œ UTF-8ë¡œ ì¸ì‹í•©ë‹ˆë‹¤.</p>

        <!-- 2. í•´ê²° ë°©ë²• ê°œìš” -->
        <h2 id="solution-overview">2. í•´ê²° ë°©ë²• ê°œìš”</h2>

        <div class="step-box">
            <h4><span class="step-number">1</span>CSV ì—…ë¡œë“œ ì‹œ</h4>
            <p>â€¢ EUC-KR/CP949 ì¸ì½”ë”©ì„ <strong>UTF-8ë¡œ ìë™ ë³€í™˜</strong><br>
            â€¢ <code>mb_detect_encoding()</code> + <code>mb_convert_encoding()</code> ì‚¬ìš©</p>
        </div>

        <div class="step-box">
            <h4><span class="step-number">2</span>CSV ë‹¤ìš´ë¡œë“œ ì‹œ</h4>
            <p>â€¢ <strong>ì§ì ‘ ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹</strong> ì‚¬ìš© (JSON + base64 ë°©ì‹ âŒ)<br>
            â€¢ <code>php://output</code>ìœ¼ë¡œ ì§ì ‘ ì¶œë ¥<br>
            â€¢ íŒŒì¼ ì‹œì‘ ë¶€ë¶„ì— <strong>UTF-8 BOM</strong> ì¶”ê°€<br>
            â€¢ <code>fputcsv()</code>ë¡œ ë°ì´í„° ì¶œë ¥ (ì¸ì½”ë”© ë³€í™˜ ì—†ì´ UTF-8 ìœ ì§€)</p>
        </div>

        <div class="alert alert-success">
            <strong>âœ… í•µì‹¬ ì›ì¹™</strong><br>
            â€¢ ëª¨ë“  ë°ì´í„°ëŠ” <strong>UTF-8</strong>ë¡œ ì²˜ë¦¬<br>
            â€¢ Excel í˜¸í™˜ì„ ìœ„í•´ <strong>UTF-8 BOM</strong> ì¶”ê°€<br>
            â€¢ <strong>ì§ì ‘ ìŠ¤íŠ¸ë¦¬ë°</strong> ë°©ì‹ìœ¼ë¡œ ì¶œë ¥ (ë²„í¼ë§ âŒ)
        </div>

        <!-- 3. CSV ì—…ë¡œë“œ êµ¬í˜„ -->
        <h2 id="upload">3. CSV ì—…ë¡œë“œ êµ¬í˜„ (í•œê¸€ â†’ UTF-8)</h2>

        <h3>3.1 ì™„ì„± ì½”ë“œ</h3>

<div class="code-block">
<?php
// CSV ì—…ë¡œë“œ ì²˜ë¦¬
if ($action === 'upload_csv' && isset($_FILES['csv_file'])) {
    $file = $_FILES['csv_file']['tmp_name'];
    
    // 1ï¸âƒ£ íŒŒì¼ ì½ê¸°
    $csvData = file_get_contents($file);
    
    // 2ï¸âƒ£ ì¸ì½”ë”© ê°ì§€ ë° ë³€í™˜
    $encoding = mb_detect_encoding($csvData, ['UTF-8', 'EUC-KR', 'CP949'], true);
    if ($encoding !== 'UTF-8') {
        $csvData = mb_convert_encoding($csvData, 'UTF-8', $encoding);
    }
    
    // 3ï¸âƒ£ UTF-8 BOM ì œê±° (ìˆë‹¤ë©´)
    $csvData = str_replace("\xEF\xBB\xBF", '', $csvData);
    
    // 4ï¸âƒ£ CSV íŒŒì‹±
    $lines = explode("\n", $csvData);
    
    foreach ($lines as $index => $line) {
        if ($index === 0 || empty(trim($line))) continue; // í—¤ë” ìŠ¤í‚µ
        
        $row = str_getcsv($line);
        
        // 5ï¸âƒ£ ë°ì´í„° ì²˜ë¦¬ (ì´ë¯¸ UTF-8ì´ë¯€ë¡œ ì¶”ê°€ ë³€í™˜ ë¶ˆí•„ìš”)
        $productCode = trim($row[0] ?? '');
        $productName = trim($row[1] ?? '');
        // ... ë°ì´í„° ì €ì¥
    }
}
?>
</div>

        <h3>3.2 í•µì‹¬ í¬ì¸íŠ¸</h3>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>í•­ëª©</th>
                    <th>ì„¤ëª…</th>
                    <th>ì½”ë“œ</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ì¸ì½”ë”© ê°ì§€</strong></td>
                    <td>UTF-8, EUC-KR, CP949 ìˆœì„œë¡œ ê°ì§€</td>
                    <td><code>mb_detect_encoding($csvData, ['UTF-8', 'EUC-KR', 'CP949'], true)</code></td>
                </tr>
                <tr>
                    <td><strong>ì¸ì½”ë”© ë³€í™˜</strong></td>
                    <td>UTF-8ì´ ì•„ë‹ˆë©´ ë³€í™˜</td>
                    <td><code>mb_convert_encoding($csvData, 'UTF-8', $encoding)</code></td>
                </tr>
                <tr>
                    <td><strong>BOM ì œê±°</strong></td>
                    <td>ì—…ë¡œë“œ ì‹œ BOM ì œê±°</td>
                    <td><code>str_replace("\xEF\xBB\xBF", '', $csvData)</code></td>
                </tr>
            </tbody>
        </table>

        <div class="alert alert-warning">
            <strong>âš ï¸ ì£¼ì˜ì‚¬í•­</strong><br>
            â€¢ <code>mb_detect_encoding()</code>ì˜ ì„¸ ë²ˆì§¸ ì¸ìë¥¼ <code>true</code>ë¡œ ì„¤ì • (strict mode)<br>
            â€¢ BOM ì œê±°ëŠ” ì—…ë¡œë“œ ì‹œì—ë§Œ ìˆ˜í–‰ (ë‹¤ìš´ë¡œë“œ ì‹œì—ëŠ” ì¶”ê°€)
        </div>

        <!-- 4. CSV ë‹¤ìš´ë¡œë“œ êµ¬í˜„ -->
        <h2 id="download">4. CSV ë‹¤ìš´ë¡œë“œ êµ¬í˜„ (UTF-8 BOM)</h2>

        <h3>4.1 âœ… ì˜¬ë°”ë¥¸ ë°©ì‹: ì§ì ‘ ìŠ¤íŠ¸ë¦¬ë°</h3>

<div class="code-block">
<?php
// CSV ë‹¤ìš´ë¡œë“œ ì²˜ë¦¬ (ì§ì ‘ ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹)
if ($action === 'export_csv') {
    $data = loadData();
    $products = $data['products'];
    
    // 1ï¸âƒ£ HTTP í—¤ë” ì„¤ì •
    header('Content-Type: text/csv; charset=UTF-8');
    header('Content-Disposition: attachment; filename="products_' . date('Ymd_His') . '.csv"');
    header('Cache-Control: no-cache, must-revalidate');
    
    // 2ï¸âƒ£ php://outputìœ¼ë¡œ ì§ì ‘ ì¶œë ¥
    $output = fopen('php://output', 'w');
    
    // 3ï¸âƒ£ UTF-8 BOM ì¶”ê°€ (Excel ì¸ì‹ìš©)
    fputs($output, "\xEF\xBB\xBF");
    
    // 4ï¸âƒ£ í—¤ë” ì¶œë ¥ (ì¸ì½”ë”© ë³€í™˜ ì—†ì´ UTF-8 ìœ ì§€)
    $headers = ['ì œí’ˆì½”ë“œ', 'URL', 'ì´ë¯¸ì§€URL', 'ì¶”ê°€ìš”ì²­ì‚¬í•­', 'ì œí’ˆëª…'];
    fputcsv($output, $headers);
    
    // 5ï¸âƒ£ ë°ì´í„° ì¶œë ¥ (ì¸ì½”ë”© ë³€í™˜ ì—†ì´ UTF-8 ìœ ì§€)
    foreach ($products as $product) {
        $row = [
            $product['product_code'] ?? '',
            $product['url'] ?? '',
            $product['image_url'] ?? '',
            $product['additional_request'] ?? '',
            $product['product_name'] ?? ''
        ];
        fputcsv($output, $row);
    }
    
    // 6ï¸âƒ£ íŒŒì¼ í•¸ë“¤ ë‹«ê¸° ë° ì¢…ë£Œ
    fclose($output);
    exit;
}
?>
</div>

        <h3>4.2 âŒ ì˜ëª»ëœ ë°©ì‹: JSON + base64</h3>

<div class="code-block">
<?php
// âŒ ì´ ë°©ì‹ì€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”!
if ($action === 'export_csv') {
    ob_start(); // ë²„í¼ë§ ì‹œì‘
    
    $output = fopen('php://output', 'w');
    fputs($output, "\xEF\xBB\xBF");
    fputcsv($output, $headers);
    // ... ë°ì´í„° ì¶œë ¥
    
    $csvContent = ob_get_clean(); // ë²„í¼ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
    
    // JSONìœ¼ë¡œ ì‘ë‹µ (ë¬¸ì œ ë°œìƒ!)
    echo json_encode([
        'success' => true,
        'csv' => base64_encode($csvContent),
        'filename' => 'products.csv'
    ]);
    exit;
}
?>
</div>

<div class="code-block javascript">
// âŒ JavaScriptì—ì„œ ì²˜ë¦¬ (í•œê¸€ ê¹¨ì§ ë°œìƒ)
const response = await fetch(...);
const data = await response.json();
const blob = new Blob([atob(data.csv)], { type: 'text/csv;charset=utf-8' });
// BOMì´ ì†ì‹¤ë˜ê±°ë‚˜ ì¸ì½”ë”© ì¶©ëŒ ë°œìƒ
</div>

        <div class="alert alert-danger">
            <strong>âŒ JSON + base64 ë°©ì‹ì˜ ë¬¸ì œì </strong><br>
            â€¢ <code>ob_start()</code>ì™€ <code>php://output</code> ì¶©ëŒ â†’ BOM ì†ì‹¤<br>
            â€¢ <code>base64_encode/decode</code> ê³¼ì •ì—ì„œ ì¸ì½”ë”© ì¶©ëŒ<br>
            â€¢ JavaScript <code>atob()</code>ê°€ UTF-8ì„ ì œëŒ€ë¡œ ì²˜ë¦¬í•˜ì§€ ëª»í•¨<br>
            â€¢ ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œ ì¦ê°€
        </div>

        <h3>4.3 JavaScript ì²˜ë¦¬ ë°©ì‹</h3>

<div class="code-block javascript">
// âœ… ì˜¬ë°”ë¥¸ ë°©ì‹: í¼ ì„œë¸Œë°‹ìœ¼ë¡œ ì§ì ‘ ë‹¤ìš´ë¡œë“œ
function exportCSV() {
    const ids = getSelectedIds();
    
    // í¼ ìƒì„±
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '';
    
    // action í•„ë“œ
    const actionInput = document.createElement('input');
    actionInput.type = 'hidden';
    actionInput.name = 'action';
    actionInput.value = 'export_csv';
    form.appendChild(actionInput);
    
    // ids í•„ë“œ (ì„ íƒì )
    const idsInput = document.createElement('input');
    idsInput.type = 'hidden';
    idsInput.name = 'ids';
    idsInput.value = JSON.stringify(ids);
    form.appendChild(idsInput);
    
    // í¼ ì œì¶œ
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
}
</div>

        <!-- 5. í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ êµ¬í˜„ -->
        <h2 id="template">5. í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ êµ¬í˜„</h2>

<div class="code-block">
<?php
// í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ (ì§ì ‘ ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹)
if ($action === 'download_template') {
    // HTTP í—¤ë” ì„¤ì •
    header('Content-Type: text/csv; charset=UTF-8');
    header('Content-Disposition: attachment; filename="template.csv"');
    header('Cache-Control: no-cache, must-revalidate');
    
    $output = fopen('php://output', 'w');
    
    // UTF-8 BOM ì¶”ê°€
    fputs($output, "\xEF\xBB\xBF");
    
    // í—¤ë”
    $headers = ['ì œí’ˆì½”ë“œ', 'URL', 'ì´ë¯¸ì§€URL', 'ì¶”ê°€ìš”ì²­ì‚¬í•­', 'ì œí’ˆëª…'];
    fputcsv($output, $headers);
    
    // ìƒ˜í”Œ ë°ì´í„°
    $sampleData = [
        ['2243196081', 'https://example.com', '', 'ê°€ì„±ë¹„ ê°•ì¡°', ''],
        ['2242937882', 'https://example.com', '', 'í• ì¸ í˜œíƒ ê°•ì¡°', '']
    ];
    
    foreach ($sampleData as $row) {
        fputcsv($output, $row);
    }
    
    fclose($output);
    exit;
}
?>
</div>

<div class="code-block javascript">
// JavaScript - í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
function downloadTemplate() {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '';
    
    const actionInput = document.createElement('input');
    actionInput.type = 'hidden';
    actionInput.name = 'action';
    actionInput.value = 'download_template';
    form.appendChild(actionInput);
    
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
}
</div>

        <!-- 6. ë¹„êµí‘œ -->
        <h2 id="comparison">6. ì˜¬ë°”ë¥¸ ë°©ì‹ vs ì˜ëª»ëœ ë°©ì‹ ë¹„êµ</h2>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>í•­ëª©</th>
                    <th>âœ… ì˜¬ë°”ë¥¸ ë°©ì‹ (v2)</th>
                    <th>âŒ ì˜ëª»ëœ ë°©ì‹ (v4 ì´ì „)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ì¶œë ¥ ë°©ì‹</strong></td>
                    <td><span class="badge badge-success">ì§ì ‘ ìŠ¤íŠ¸ë¦¬ë°</span><br><code>fopen('php://output', 'w')</code></td>
                    <td><span class="badge badge-danger">ë²„í¼ë§ + JSON</span><br><code>ob_start() + json_encode()</code></td>
                </tr>
                <tr>
                    <td><strong>BOM ì²˜ë¦¬</strong></td>
                    <td><code>fputs($output, "\xEF\xBB\xBF");</code><br>ì§ì ‘ íŒŒì¼ì— ì“°ê¸°</td>
                    <td>ë²„í¼ì— ì“°ê¸° â†’ ì†ì‹¤ ê°€ëŠ¥ì„±</td>
                </tr>
                <tr>
                    <td><strong>ì¸ì½”ë”© ë³€í™˜</strong></td>
                    <td>âŒ ë³€í™˜ ì—†ìŒ (UTF-8 ìœ ì§€)</td>
                    <td>âŒ <code>mb_convert_encoding()</code> ì‚¬ìš©</td>
                </tr>
                <tr>
                    <td><strong>JavaScript</strong></td>
                    <td>í¼ ì„œë¸Œë°‹ (ì§ì ‘ ë‹¤ìš´ë¡œë“œ)</td>
                    <td><code>fetch() + Blob()</code> (ì¸ì½”ë”© ì¶©ëŒ)</td>
                </tr>
                <tr>
                    <td><strong>Excel í˜¸í™˜</strong></td>
                    <td><span class="badge badge-success">ì™„ë²½</span></td>
                    <td><span class="badge badge-danger">í•œê¸€ ê¹¨ì§</span></td>
                </tr>
                <tr>
                    <td><strong>ë©”ëª¨ë¦¬ íš¨ìœ¨</strong></td>
                    <td><span class="badge badge-success">ë†’ìŒ</span> (ìŠ¤íŠ¸ë¦¬ë°)</td>
                    <td><span class="badge badge-danger">ë‚®ìŒ</span> (ì „ì²´ ë²„í¼ë§)</td>
                </tr>
            </tbody>
        </table>

        <!-- 7. ë¬¸ì œ í•´ê²° -->
        <h2 id="troubleshooting">7. ë¬¸ì œ í•´ê²° (Troubleshooting)</h2>

        <h3>7.1 ë¬¸ì œ: Excelì—ì„œ í•œê¸€ì´ "Ã¬ Ã­Ã¬Â½Ã«"ë¡œ ë³´ì„</h3>
        <div class="alert alert-info">
            <strong>ì›ì¸:</strong> UTF-8 BOMì´ ì—†ê±°ë‚˜ ì†ì‹¤ë¨<br>
            <strong>í•´ê²°:</strong> <code>fputs($output, "\xEF\xBB\xBF");</code>ì„ íŒŒì¼ ì‹œì‘ ë¶€ë¶„ì— ì¶”ê°€
        </div>

        <h3>7.2 ë¬¸ì œ: ë©”ëª¨ì¥ì—ì„œëŠ” ì •ìƒì´ì§€ë§Œ Excelì—ì„œ ê¹¨ì§</h3>
        <div class="alert alert-info">
            <strong>ì›ì¸:</strong> Excelì´ ì‹œìŠ¤í…œ ê¸°ë³¸ ì¸ì½”ë”©(CP949)ìœ¼ë¡œ ì—´ê¸° ì‹œë„<br>
            <strong>í•´ê²°:</strong> UTF-8 BOM ì¶”ê°€ í•„ìˆ˜
        </div>

        <h3>7.3 ë¬¸ì œ: BOMì´ ì¶”ê°€ë˜ì—ˆëŠ”ë°ë„ ê¹¨ì§</h3>
        <div class="alert alert-info">
            <strong>ì›ì¸:</strong> <code>ob_start()</code>ì™€ <code>php://output</code> ì¶©ëŒë¡œ BOM ì†ì‹¤<br>
            <strong>í•´ê²°:</strong> ì§ì ‘ ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹ ì‚¬ìš© (ë²„í¼ë§ ì œê±°)
        </div>

        <h3>7.4 ë¬¸ì œ: CSV ì—…ë¡œë“œ ì‹œ í•œê¸€ ê¹¨ì§</h3>
        <div class="alert alert-info">
            <strong>ì›ì¸:</strong> EUC-KR/CP949 ì¸ì½”ë”© íŒŒì¼ì„ UTF-8ë¡œ ì½ê¸° ì‹œë„<br>
            <strong>í•´ê²°:</strong> <code>mb_detect_encoding()</code> + <code>mb_convert_encoding()</code> ì‚¬ìš©
        </div>

        <h3>7.5 ë¬¸ì œ: JSON + base64 ë°©ì‹ì—ì„œ í•œê¸€ ê¹¨ì§</h3>
        <div class="alert alert-info">
            <strong>ì›ì¸:</strong> JavaScript <code>atob()</code>ê°€ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ì˜ëª» ì²˜ë¦¬<br>
            <strong>í•´ê²°:</strong> í¼ ì„œë¸Œë°‹ ë°©ì‹ìœ¼ë¡œ ë³€ê²½ (ì§ì ‘ ë‹¤ìš´ë¡œë“œ)
        </div>

        <!-- 8. ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
        <h2 id="checklist">8. êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>

        <div class="checklist">
            <h4>CSV ì—…ë¡œë“œ ì²´í¬ë¦¬ìŠ¤íŠ¸</h4>
            <ul>
                <li><code>mb_detect_encoding()</code>ìœ¼ë¡œ ì¸ì½”ë”© ê°ì§€</li>
                <li>UTF-8ì´ ì•„ë‹ˆë©´ <code>mb_convert_encoding()</code>ë¡œ ë³€í™˜</li>
                <li>BOM ì œê±° (<code>str_replace("\xEF\xBB\xBF", '', $csvData)</code>)</li>
                <li><code>str_getcsv()</code>ë¡œ íŒŒì‹±</li>
            </ul>
        </div>

        <div class="checklist">
            <h4>CSV ë‹¤ìš´ë¡œë“œ ì²´í¬ë¦¬ìŠ¤íŠ¸</h4>
            <ul>
                <li><code>Content-Type: text/csv; charset=UTF-8</code> í—¤ë” ì„¤ì •</li>
                <li><code>fopen('php://output', 'w')</code>ë¡œ ì§ì ‘ ì¶œë ¥</li>
                <li><code>fputs($output, "\xEF\xBB\xBF")</code>ë¡œ UTF-8 BOM ì¶”ê°€</li>
                <li><code>fputcsv()</code>ë¡œ ë°ì´í„° ì¶œë ¥ (ì¸ì½”ë”© ë³€í™˜ âŒ)</li>
                <li><code>fclose($output); exit;</code>ë¡œ ì¢…ë£Œ</li>
                <li>JavaScriptì—ì„œëŠ” í¼ ì„œë¸Œë°‹ ë°©ì‹ ì‚¬ìš©</li>
            </ul>
        </div>

        <div class="checklist">
            <h4>ê¸ˆì§€ ì‚¬í•­</h4>
            <ul>
                <li>âŒ <code>ob_start()</code> + <code>php://output</code> ì¡°í•© ì‚¬ìš©</li>
                <li>âŒ JSON + base64 ì¸ì½”ë”© ë°©ì‹ ì‚¬ìš©</li>
                <li>âŒ <code>mb_convert_encoding($str, 'EUC-KR', 'UTF-8')</code> ì‚¬ìš©</li>
                <li>âŒ JavaScript <code>fetch() + Blob()</code> ë°©ì‹ ì‚¬ìš©</li>
            </ul>
        </div>

        <!-- ì˜ˆì œ ì½”ë“œ ëª¨ìŒ -->
        <h2>9. ì™„ì„± ì˜ˆì œ ì½”ë“œ</h2>

        <h3>9.1 PHP ì „ì²´ ì½”ë“œ</h3>

<div class="code-block">
<?php
// í•œê¸€ ì²˜ë¦¬ë¥¼ ìœ„í•œ ì„¤ì •
mb_internal_encoding('UTF-8');
mb_http_output('UTF-8');

$action = $_POST['action'] ?? $_GET['action'] ?? '';

// ===== CSV ì—…ë¡œë“œ =====
if ($action === 'upload_csv' && isset($_FILES['csv_file'])) {
    $file = $_FILES['csv_file']['tmp_name'];
    $csvData = file_get_contents($file);
    
    // ì¸ì½”ë”© ê°ì§€ ë° ë³€í™˜
    $encoding = mb_detect_encoding($csvData, ['UTF-8', 'EUC-KR', 'CP949'], true);
    if ($encoding !== 'UTF-8') {
        $csvData = mb_convert_encoding($csvData, 'UTF-8', $encoding);
    }
    
    // UTF-8 BOM ì œê±°
    $csvData = str_replace("\xEF\xBB\xBF", '', $csvData);
    
    // CSV íŒŒì‹± ë° ì²˜ë¦¬
    $lines = explode("\n", $csvData);
    // ... ë°ì´í„° ì²˜ë¦¬
    
    echo json_encode(['success' => true]);
    exit;
}

// ===== CSV ë‹¤ìš´ë¡œë“œ =====
if ($action === 'export_csv') {
    $data = loadData(); // ë°ì´í„° ë¡œë“œ
    
    // HTTP í—¤ë” ì„¤ì •
    header('Content-Type: text/csv; charset=UTF-8');
    header('Content-Disposition: attachment; filename="data_' . date('Ymd_His') . '.csv"');
    header('Cache-Control: no-cache, must-revalidate');
    
    $output = fopen('php://output', 'w');
    
    // UTF-8 BOM ì¶”ê°€
    fputs($output, "\xEF\xBB\xBF");
    
    // í—¤ë” ì¶œë ¥
    $headers = ['ì œí’ˆì½”ë“œ', 'ì œí’ˆëª…', 'ê°€ê²©'];
    fputcsv($output, $headers);
    
    // ë°ì´í„° ì¶œë ¥
    foreach ($data as $row) {
        fputcsv($output, [
            $row['code'],
            $row['name'],
            $row['price']
        ]);
    }
    
    fclose($output);
    exit;
}

// ===== í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ =====
if ($action === 'download_template') {
    header('Content-Type: text/csv; charset=UTF-8');
    header('Content-Disposition: attachment; filename="template.csv"');
    header('Cache-Control: no-cache, must-revalidate');
    
    $output = fopen('php://output', 'w');
    fputs($output, "\xEF\xBB\xBF");
    
    $headers = ['ì œí’ˆì½”ë“œ', 'ì œí’ˆëª…', 'ê°€ê²©'];
    fputcsv($output, $headers);
    
    // ìƒ˜í”Œ ë°ì´í„°
    fputcsv($output, ['SAMPLE001', 'ìƒ˜í”Œ ìƒí’ˆ', '10000']);
    
    fclose($output);
    exit;
}
?>
</div>

        <h3>9.2 HTML + JavaScript ì „ì²´ ì½”ë“œ</h3>

<div class="code-block html">
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>CSV ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ</title>
</head>
<body>
    <!-- CSV ì—…ë¡œë“œ -->
    <input type="file" id="csvUpload" accept=".csv">
    
    <!-- ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
    <button onclick="exportCSV()">CSV ë‹¤ìš´ë¡œë“œ</button>
    <button onclick="downloadTemplate()">í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</button>
    
    <script>
        // CSV ì—…ë¡œë“œ
        document.getElementById('csvUpload').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('action', 'upload_csv');
            formData.append('csv_file', file);
            
            const response = await fetch('', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            alert(data.success ? 'ì—…ë¡œë“œ ì„±ê³µ' : 'ì—…ë¡œë“œ ì‹¤íŒ¨');
        });
        
        // CSV ë‹¤ìš´ë¡œë“œ (í¼ ì„œë¸Œë°‹ ë°©ì‹)
        function exportCSV() {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '';
            
            const actionInput = document.createElement('input');
            actionInput.type = 'hidden';
            actionInput.name = 'action';
            actionInput.value = 'export_csv';
            form.appendChild(actionInput);
            
            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form);
        }
        
        // í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
        function downloadTemplate() {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '';
            
            const actionInput = document.createElement('input');
            actionInput.type = 'hidden';
            actionInput.name = 'action';
            actionInput.value = 'download_template';
            form.appendChild(actionInput);
            
            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form);
        }
    </script>
</body>
</html>
</div>

        <!-- ìš”ì•½ -->
        <h2>10. í•µì‹¬ ìš”ì•½</h2>

        <div class="alert alert-success">
            <h4>âœ… ë°˜ë“œì‹œ ê¸°ì–µí•  3ê°€ì§€ ì›ì¹™</h4>
            <ol style="margin-left: 20px;">
                <li><strong>UTF-8 BOM ì¶”ê°€</strong>: <code>fputs($output, "\xEF\xBB\xBF");</code></li>
                <li><strong>ì§ì ‘ ìŠ¤íŠ¸ë¦¬ë°</strong>: <code>fopen('php://output', 'w')</code></li>
                <li><strong>ì¸ì½”ë”© ë³€í™˜ ê¸ˆì§€</strong>: UTF-8 ë°ì´í„°ëŠ” ë³€í™˜í•˜ì§€ ë§ê³  ê·¸ëŒ€ë¡œ ì¶œë ¥</li>
            </ol>
        </div>

        <div class="alert alert-danger">
            <h4>âŒ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ</h4>
            <ol style="margin-left: 20px;">
                <li><code>ob_start()</code> + <code>php://output</code> ì¡°í•©</li>
                <li>JSON + base64 ì¸ì½”ë”©ìœ¼ë¡œ CSV ì „ì†¡</li>
                <li><code>mb_convert_encoding($str, 'EUC-KR', 'UTF-8')</code> ì‚¬ìš©</li>
            </ol>
        </div>

        <div class="footer">
            <p><strong>í•œê¸€ CSV ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ í‘œì¤€ êµ¬í˜„ ê°€ì´ë“œ</strong></p>
            <p>ì‘ì„±ì¼: 2025-11-13 | H-mall ìƒí’ˆ ê´€ë¦¬ ì‹œìŠ¤í…œ í”„ë¡œì íŠ¸ ê¸°ë°˜</p>
            <p>Â© 2025 All Rights Reserved</p>
        </div>
    </div>
</body>
</html>
