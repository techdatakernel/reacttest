# 🚀 A/B 테스트 통합 대시보드 배포 가이드

## 📋 수정 사항 요약

### 1️⃣ **대시보드 (ab-test-dashboard_fixed.html)**

**주요 개선 사항:**
- ✅ API 응답에서 **전체 페이지 목록 자동 로드**
- ✅ 모든 탭에서 **페이지 드롭다운 목록 정상 표시**
- ✅ **null 체크 강화** - 데이터 유효성 검증
- ✅ **상세 console 로깅** - 디버깅 용이성 향상
- ✅ **UI/UX 개선** - 애니메이션, 호버 효과, 색상 그라데이션
- ✅ **반응형 디자인** - 모바일 최적화
- ✅ **에러 처리** - 모든 오류 상황에 알림 표시

**수정된 함수들:**
| 함수 | 수정 내용 |
|------|---------|
| `loadConfig()` | GET 요청으로 전체 페이지 반환 |
| `loadPagesList()` | null 체크 추가, 페이지 목록 표시 |
| `loadPagesForControl()` | 제어용 드롭다운 로드 개선 |
| `loadPagesForAnalytics()` | 분석용 드롭다운 로드 개선 |
| `loadPageAnalytics()` | 데이터 유효성 검증 강화 |
| `switchTab()` | 탭 전환 시 데이터 자동 로드 |

---

### 2️⃣ **API (ab-test-config.php)**

**주요 개선 사항:**
- ✅ **GET 요청 처리 개선**
  - `pagePath` 없을 때: 전체 `pages` 객체 반환
  - `pagePath` 있을 때: 특정 페이지 설정 반환
- ✅ **success 필드 추가** - 응답 구조 명확화
- ✅ **에러 처리 강화** - 모든 예외 상황 처리
- ✅ **createdAt 필드 추가** - 페이지 생성 시간 추적

**API 응답 구조:**
```javascript
// pagePath 없을 때 (전체 페이지 목록)
{
    "success": true,
    "config": {
        "/page1": { ... },
        "/page2": { ... }
    },
    "global": { ... },
    "timestamp": "2025-11-15T..."
}

// pagePath 있을 때 (특정 페이지)
{
    "success": true,
    "config": { ... },
    "global": { ... },
    "timestamp": "2025-11-15T..."
}
```

---

### 3️⃣ **설정 파일 (ab-test-config.json)**

**주요 변경:**
- ✅ **escaped slashes 제거**
  - ❌ 이전: `"\/ob\/stella\/..."`
  - ✅ 현재: `"/ob/stella/..."`
- ✅ **createdAt 필드 추가** - 페이지 생성 시간 추적
- ✅ **구조 명확화** - 모든 필수 필드 포함

---

## 🔧 배포 절차

### Step 1: 서버에 파일 배포

```bash
# 서버 SSH 접속
ssh user@abi-ops.miraepmp.co.kr

# 1️⃣ 기존 파일 백업
cd /var/www/html_bak/ob/stella/abtest2

cp index.html index.html.bak
cp api/ab-test-config.php api/ab-test-config.php.bak
cp api/ab-test-config.json api/ab-test-config.json.bak

# 2️⃣ 새 파일 배포
# ab-test-dashboard_fixed.html → index.html
wget -O index.html https://your-download-link/ab-test-dashboard_fixed.html

# ab-test-config.php → api/ab-test-config.php
wget -O api/ab-test-config.php https://your-download-link/ab-test-config.php

# ab-test-config.json → api/ab-test-config.json
wget -O api/ab-test-config.json https://your-download-link/ab-test-config.json

# 3️⃣ 권한 설정
chmod 644 index.html
chmod 644 api/ab-test-config.php
chmod 644 api/ab-test-config.json
chmod 755 api/

# 4️⃣ 소유권 설정
chown apache:apache index.html
chown apache:apache api/ab-test-config.php
chown apache:apache api/ab-test-config.json
chown apache:apache api/
```

---

### Step 2: 파일 구조 확인

```bash
tree /var/www/html_bak/ob/stella/abtest2/ -L 2

# 예상 출력:
# /var/www/html_bak/ob/stella/abtest2/
# ├── index.html                          ✅ (ab-test-dashboard_fixed.html)
# ├── test-product-1.html
# ├── test-product-2.html
# ├── test-product-3.html
# ├── js/
# │   └── ab-test-tracker.js
# └── api/
#     ├── ab-test-log.php
#     ├── ab-test-analytics.php
#     ├── ab-test-config.php              ✅ (수정)
#     ├── ab-test-config.json             ✅ (수정)
#     └── ab-test-logs/
```

---

### Step 3: 브라우저에서 확인

```bash
# 1️⃣ 대시보드 접속
https://abi-ops.miraepmp.co.kr/ob/stella/abtest2/index.html

# 2️⃣ F12 개발자 도구 → Console 탭 확인
# 다음 로그가 보이면 정상:
# 📋 [Dashboard] Config 로드 시작
# 📋 [Dashboard] Config 응답: {...}
# ✅ [Dashboard] 로드된 페이지: ["/products/hanmac-...", "/ob/stella/abtest2/test-product-1.html"]
# 📋 [Dashboard] 페이지 목록 로드 시작
# 📋 [Dashboard] 총 페이지: 2
# ✅ [Dashboard] 페이지 목록 로드 완료

# 3️⃣ UI 확인
# ✅ 페이지 관리 탭 → 테이블에 2개 페이지 표시
# ✅ 설정 제어 탭 → 드롭다운에 2개 페이지 표시
# ✅ 통계 분석 탭 → 드롭다운에 2개 페이지 표시
```

---

## ✅ 테스트 체크리스트

```
기본 기능
□ 브라우저 개발자도구 Console에서 에러 없음
□ 페이지 관리 탭에서 2개 페이지 목록 표시
  - "한맥 판매처 순서 최적화" (/products/...)
  - "test1 - CTA 버튼 테스트" (/ob/stella/...)

탭별 기능
□ 📄 페이지 관리
  - 페이지 목록 테이블 표시 ✅
  - 새 페이지 추가 버튼 작동 ✅
  - 페이지 삭제 버튼 작동 ✅

□ ⚙️ 설정 제어
  - 페이지 선택 드롭다운에 2개 페이지 표시 ✅
  - 페이지 선택 시 설정 로드 ✅
  - 모드 선택 가능 ✅
  - 설정 저장 작동 ✅

□ 📈 통계 분석
  - 페이지 선택 드롭다운에 2개 페이지 표시 ✅
  - 페이지 선택 시 날짜 필터 표시 ✅
  - 날짜 범위 선택 가능 ✅
  - 조회 버튼으로 데이터 로드 ✅
  - CSV 다운로드 작동 ✅

API 테스트
□ GET /api/ab-test-config.php
  응답 구조 확인:
  - "success": true ✅
  - "config": { 2개 페이지 } ✅
  - "global": {...} ✅

□ POST /api/ab-test-config.php
  - action: 'update' 작동 ✅
  - action: 'addPage' 작동 ✅
  - action: 'deletePage' 작동 ✅
```

---

## 🔍 문제 해결

### 문제: 페이지 목록이 여전히 안 보임

**원인:**
1. 브라우저 캐시가 남아있음
2. JSON 파일의 escaped slashes 문제
3. PHP 파일이 제대로 업로드되지 않음

**해결:**
```bash
# 1️⃣ 브라우저 캐시 삭제
# Chrome: Ctrl+Shift+Delete
# Firefox: Ctrl+Shift+Delete
# Safari: Cmd+Shift+Delete

# 2️⃣ 서버에서 JSON 파일 확인
cat /var/www/html_bak/ob/stella/abtest2/api/ab-test-config.json | grep -E '^\s*"/'

# 예상 출력: "/products/..." "/ob/stella/..." (escaped slashes 없음)

# 3️⃣ PHP 파일 문법 확인
php -l /var/www/html_bak/ob/stella/abtest2/api/ab-test-config.php

# 예상 출력: No syntax errors detected

# 4️⃣ API 직접 테스트
curl -s https://abi-ops.miraepmp.co.kr/ob/stella/abtest2/api/ab-test-config.php | jq .
```

---

### 문제: API 응답이 null이 나옴

**원인:**
- CONFIG_API 엔드포인트가 잘못됨
- PHP 파일이 JSON을 반환하지 않음

**해결:**
```bash
# 1️⃣ 콘솔에서 CONFIG_API 확인
# F12 → Console 탭에 다음 입력:
console.log(CONFIG_API)

# 예상: https://abi-ops.miraepmp.co.kr/ob/stella/abtest2/api/ab-test-config.php

# 2️⃣ 직접 API 호출 테스트
# 콘솔에 다음 입력:
fetch('https://abi-ops.miraepmp.co.kr/ob/stella/abtest2/api/ab-test-config.php')
  .then(r => r.json())
  .then(d => console.log(d))
```

---

## 📊 성능 최적화

### 캐싱 전략

```php
// header에 추가:
header('Cache-Control: max-age=3600'); // 1시간 캐시
```

### 데이터 양 최적화

```javascript
// 분석 데이터는 최대 20개 로그만 표시
// 필요 시 페이지네이션 추가
```

---

## 📝 로그 확인

```bash
# Apache 에러 로그 확인
tail -f /var/log/apache2/error_log | grep abtest

# PHP 에러 확인
tail -f /var/log/apache2/other_vhosts_access_log | grep abtest
```

---

## 🎯 결과 확인

### ✅ 성공 시나리오

1. **대시보드 로드 시**
   - 페이지 관리 탭에 즉시 2개 페이지 표시
   - 설정 제어 탭 클릭 시 드롭다운 로드
   - 통계 분석 탭 클릭 시 드롭다운 로드

2. **콘솔 로그**
   ```
   📋 [Dashboard] Config 로드 시작
   📋 [Dashboard] Config 응답: {success: true, config: {...}, ...}
   ✅ [Dashboard] 로드된 페이지: (2) ["/products/hanmac-...", "/ob/stella/..."]
   📋 [Dashboard] 페이지 목록 로드 시작
   📋 [Dashboard] 총 페이지: 2
   ✅ [Dashboard] 페이지 목록 로드 완료
   ```

3. **기능 확인**
   - 모든 탭에서 페이지 드롭다운 작동
   - 새 페이지 추가/삭제 가능
   - 모드 변경 가능
   - 통계 데이터 로드 가능

---

## 📞 지원

문제 발생 시:
1. 브라우저 F12 → Console에서 에러 메시지 확인
2. 위의 "문제 해결" 섹션 참고
3. 서버 로그 확인: `/var/log/apache2/`

