<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œë§¥ A/B í…ŒìŠ¤íŠ¸ ì‹œì—° í˜ì´ì§€</title>
    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
        }

        .test-header {
            background: #1a472a;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .test-header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .test-info {
            background: #2d5a3f;
            padding: 15px;
            margin-top: 10px;
            border-radius: 8px;
            font-size: 14px;
        }

        .test-info strong {
            display: inline-block;
            padding: 4px 12px;
            background: #fff;
            color: #1a472a;
            border-radius: 4px;
            margin-left: 10px;
            font-weight: 600;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .product-section {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .product-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .product-header h2 {
            font-size: 32px;
            color: #1a472a;
            margin-bottom: 10px;
        }

        .product-header p {
            color: #666;
            font-size: 16px;
        }

        .purchase-section {
            margin-top: 40px;
        }

        .purchase-section h3 {
            font-size: 24px;
            color: #1a472a;
            margin-bottom: 20px;
            text-align: center;
        }

        .dtc-dwcr-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .dtc-dwcr-list li {
            display: flex;
        }

        .dtc-dwcr-list a {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            width: 100%;
            min-height: 80px;
        }

        .dtc-dwcr-list a:hover {
            border-color: #1a472a;
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(26, 71, 42, 0.15);
        }

        /* ì´ˆê¸°ì—ëŠ” ë‘˜ ë‹¤ ìˆ¨ê¹€ */
        .dtc-dwcr-list {
            display: none;
        }

        .click-counter {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1a472a;
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            min-width: 200px;
            z-index: 1000;
        }

        .click-counter h4 {
            font-size: 16px;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 10px;
        }

        .click-counter .count {
            font-size: 36px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }

        .click-counter .last-click {
            font-size: 12px;
            color: #ccc;
            margin-top: 10px;
        }

        .click-counter .status {
            font-size: 11px;
            color: #90EE90;
            margin-top: 5px;
            text-align: center;
        }

        .controls {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .controls button {
            padding: 12px 24px;
            margin: 0 10px;
            background: #1a472a;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .controls button:hover {
            background: #2d5a3f;
        }

        .controls button.secondary {
            background: #666;
        }

        .controls button.secondary:hover {
            background: #888;
        }

        .variant-badge {
            display: inline-block;
            padding: 6px 16px;
            background: #FFD700;
            color: #1a472a;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .dtc-dwcr-list {
                grid-template-columns: repeat(2, 1fr);
            }

            .click-counter {
                bottom: 10px;
                right: 10px;
                min-width: 160px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>ğŸ§ª A/B í…ŒìŠ¤íŠ¸ ì‹œì—° í˜ì´ì§€</h1>
        <p>íŒë§¤ì²˜ ìˆœì„œ ìµœì í™” í…ŒìŠ¤íŠ¸</p>
        <div class="test-info">
            í˜„ì¬ ë³´ê³  ìˆëŠ” ë²„ì „: <strong id="currentVariant">ë¡œë”©ì¤‘...</strong>
            <span class="variant-badge">í…ŒìŠ¤íŠ¸ ì§„í–‰ì¤‘</span>
        </div>
    </div>

    <div class="container">
        <div class="controls">
            <button onclick="switchVariant('A')">Variant A ë³´ê¸°</button>
            <button onclick="switchVariant('B')">Variant B ë³´ê¸°</button>
            <button onclick="resetTest()" class="secondary">ì¿ í‚¤ ì´ˆê¸°í™”</button>
            <button onclick="viewLogs()" class="secondary">í´ë¦­ ë¡œê·¸ ë³´ê¸°</button>
        </div>

        <div class="product-section">
            <div class="product-header">
                <h2>í•œë§¥ ì—‘ìŠ¤íŠ¸ë¼ í¬ë¦¬ë¯¸ ìƒìº” í•¸ë“¤ íŒ¨í‚¤ì§€</h2>
                <p>í•œë§¥ ì—‘ìŠ¤íŠ¸ë¼ í¬ë¦¬ë¯¸ ìƒì„ ìº” ì•ˆì— ê·¸ëŒ€ë¡œ ë‹´ì•„ ê¸°ë‹¤ë¦¼ë§Œ SMOOOOOOOTHí•˜ê²Œ ì°¨ì˜¤ë¥´ëŠ” í™©ìƒê±°í’ˆ</p>
            </div>

            <div class="purchase-section">
                <h3>êµ¬ë§¤í•˜ëŸ¬ê°€ê¸°</h3>

                <!-- Variant A: ì¹´ì¹´ì˜¤ ì„ ë¬¼í•˜ê¸°ê°€ ì²«ë²ˆì§¸ -->
                <ul class="dtc-dwcr-list" data-variant="A">
                    <li>
                        <a id="dtc-dwcr-kakao-gift" href="https://kko.kakao.com/Sn9n9e87U5" target="_blank" rel="noopener">
                            <span style="font-size: 16px; font-weight: 600; color: #FEE500;">ì¹´ì¹´ì˜¤ ì„ ë¬¼í•˜ê¸°</span>
                        </a>
                    </li>
                    <li>
                        <a id="dtc-dwcr-cu-pocket" href="https://www.pocketcu.co.kr/" target="_blank" rel="noopener">
                            <span style="font-size: 16px; font-weight: 600; color: #9B30B0;">CU í¬ì¼“</span>
                        </a>
                    </li>
                    <li>
                        <a id="dtc-dwcr-gs-25" href="https://abr.ge/1kg2l3" target="_blank" rel="noopener">
                            <span style="font-size: 16px; font-weight: 600; color: #0066CC;">GS25</span>
                        </a>
                    </li>
                    <li>
                        <a id="dtc-dwcr-daily-shot" href="https://open.dailyshot.co/pu4k3a" target="_blank" rel="noopener">
                            <span style="font-size: 16px; font-weight: 600; color: #FF6B35;">ë°ì¼ë¦¬ìƒ·</span>
                        </a>
                    </li>
                    <li>
                        <a id="dtc-dwcr-emart-24" href="https://abr.ge/4rmf25" target="_blank" rel="noopener">
                            <span style="font-size: 16px; font-weight: 600; color: #FFCC00;">ì´ë§ˆíŠ¸24</span>
                        </a>
                    </li>
                    <li>
                        <a id="dtc-dwcr-seven-eleven" href="https://new.7-elevenapp.co.kr/" target="_blank" rel="noopener">
                            <span style="font-size: 16px; font-weight: 600; color: #008061;">ì„¸ë¸ì¼ë ˆë¸</span>
                        </a>
                    </li>
                </ul>

                <!-- Variant B: CU í¬ì¼“ì´ ì²«ë²ˆì§¸ -->
                <ul class="dtc-dwcr-list" data-variant="B">
                    <li>
                        <a id="dtc-dwcr-cu-pocket" href="https://www.pocketcu.co.kr/" target="_blank" rel="noopener">
                            <span style="font-size: 16px; font-weight: 600; color: #9B30B0;">CU í¬ì¼“</span>
                        </a>
                    </li>
                    <li>
                        <a id="dtc-dwcr-gs-25" href="https://abr.ge/1kg2l3" target="_blank" rel="noopener">
                            <span style="font-size: 16px; font-weight: 600; color: #0066CC;">GS25</span>
                        </a>
                    </li>
                    <li>
                        <a id="dtc-dwcr-kakao-gift" href="https://kko.kakao.com/Sn9n9e87U5" target="_blank" rel="noopener">
                            <span style="font-size: 16px; font-weight: 600; color: #FEE500;">ì¹´ì¹´ì˜¤ ì„ ë¬¼í•˜ê¸°</span>
                        </a>
                    </li>
                    <li>
                        <a id="dtc-dwcr-emart-24" href="https://abr.ge/4rmf25" target="_blank" rel="noopener">
                            <span style="font-size: 16px; font-weight: 600; color: #FFCC00;">ì´ë§ˆíŠ¸24</span>
                        </a>
                    </li>
                    <li>
                        <a id="dtc-dwcr-seven-eleven" href="https://new.7-elevenapp.co.kr/" target="_blank" rel="noopener">
                            <span style="font-size: 16px; font-weight: 600; color: #008061;">ì„¸ë¸ì¼ë ˆë¸</span>
                        </a>
                    </li>
                    <li>
                        <a id="dtc-dwcr-daily-shot" href="https://open.dailyshot.co/pu4k3a" target="_blank" rel="noopener">
                            <span style="font-size: 16px; font-weight: 600; color: #FF6B35;">ë°ì¼ë¦¬ìƒ·</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="click-counter">
        <h4>ğŸ“Š í´ë¦­ í†µê³„</h4>
        <div class="count" id="clickCount">0</div>
        <div class="last-click" id="lastClick">í´ë¦­ì´ ì—†ìŠµë‹ˆë‹¤</div>
        <div class="status" id="apiStatus">ì´ˆê¸°í™”ì¤‘...</div>
    </div>

    <script>
        // â­ ì„œë²„ ì„¤ì • ê¸°ë°˜ A/B í…ŒìŠ¤íŠ¸
        (function() {
            'use strict';
            
            console.log('ğŸš€ ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘');

            const CONFIG_API = 'https://abi-ops.miraepmp.co.kr/ob/stella/abtest/api/ab-test-config.php';
            const LOG_API = 'https://abi-ops.miraepmp.co.kr/ob/stella/abtest/api/ab-test-log.php';
            const ANALYTICS_API = 'https://abi-ops.miraepmp.co.kr/ob/stella/abtest/api/ab-test-analytics.php';

            // ì±„ë„ ì´ë¦„ ë§¤í•‘
            const channelNames = {
                'dtc-dwcr-kakao-gift': 'ì¹´ì¹´ì˜¤ ì„ ë¬¼í•˜ê¸°',
                'dtc-dwcr-cu-pocket': 'CU í¬ì¼“',
                'dtc-dwcr-gs-25': 'GS25',
                'dtc-dwcr-daily-shot': 'ë°ì¼ë¦¬ìƒ·',
                'dtc-dwcr-emart-24': 'ì´ë§ˆíŠ¸24',
                'dtc-dwcr-seven-eleven': 'ì„¸ë¸ì¼ë ˆë¸'
            };

            // ë¡œì»¬ ì¹´ìš´í„°
            let localClickCount = parseInt(localStorage.getItem('demo_click_count') || '0');
            let serverConfig = null;

            // ì¿ í‚¤ ìœ í‹¸ë¦¬í‹°
            const cookies = {
                set: function(name, value, days) {
                    const date = new Date();
                    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                    const expires = "expires=" + date.toUTCString();
                    document.cookie = name + "=" + value + ";" + expires + ";path=/;SameSite=Lax";
                },
                
                get: function(name) {
                    const nameEQ = name + "=";
                    const ca = document.cookie.split(';');
                    for(let i = 0; i < ca.length; i++) {
                        let c = ca[i];
                        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
                    }
                    return null;
                },

                delete: function(name) {
                    document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                }
            };

            // ì„œë²„ ì„¤ì • ë¡œë“œ
            async function loadServerConfig() {
                try {
                    console.log('ğŸ“‹ ì„œë²„ ì„¤ì • ë¡œë“œ ì¤‘...');
                    const response = await fetch(CONFIG_API);
                    serverConfig = await response.json();
                    console.log('âœ… ì„œë²„ ì„¤ì •:', serverConfig);
                    return serverConfig;
                } catch (error) {
                    console.error('âŒ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                    serverConfig = { mode: 'ab_test' };
                    return serverConfig;
                }
            }

            // ìŠ¤ì¼€ì¤„ í™•ì¸
            function isScheduleActive() {
                if (!serverConfig || !serverConfig.schedule || !serverConfig.schedule.enabled) {
                    return false;
                }

                const now = new Date();
                const startDate = serverConfig.schedule.startDate ? new Date(serverConfig.schedule.startDate) : null;
                const endDate = serverConfig.schedule.endDate ? new Date(serverConfig.schedule.endDate) : null;

                if (startDate && now < startDate) {
                    return false;
                }

                if (endDate && now > endDate) {
                    return false;
                }

                return true;
            }

            // Variant ê²°ì • (ì„¤ì • ê¸°ë°˜)
            async function getVariant() {
                // ì„œë²„ ì„¤ì •ì´ ì—†ìœ¼ë©´ ë¡œë“œ
                if (!serverConfig) {
                    await loadServerConfig();
                }

                const mode = serverConfig.mode;
                console.log('ğŸ¯ ëª¨ë“œ:', mode);

                // 1. ìŠ¤ì¼€ì¤„ ëª¨ë“œ í™•ì¸
                if (mode === 'scheduled' && isScheduleActive()) {
                    const scheduledVariant = serverConfig.schedule.variant;
                    console.log('ğŸ“… ìŠ¤ì¼€ì¤„ í™œì„± - Variant:', scheduledVariant);
                    cookies.set('ab_version', scheduledVariant, 30);
                    return scheduledVariant;
                }

                // 2. ê°•ì œ ëª¨ë“œ
                if (mode === 'force_a') {
                    console.log('ğŸ”’ ê°•ì œ A ëª¨ë“œ');
                    cookies.set('ab_version', 'A', 30);
                    return 'A';
                }

                if (mode === 'force_b') {
                    console.log('ğŸ”’ ê°•ì œ B ëª¨ë“œ');
                    cookies.set('ab_version', 'B', 30);
                    return 'B';
                }

                // 3. ì¼ë°˜ A/B í…ŒìŠ¤íŠ¸ ëª¨ë“œ
                let variant = cookies.get('ab_version');
                
                if (!variant) {
                    variant = Math.random() < 0.5 ? 'A' : 'B';
                    cookies.set('ab_version', variant, 30);
                    console.log('ğŸ² ì‹ ê·œ í• ë‹¹ - Variant:', variant);
                } else {
                    console.log('ğŸª ì¿ í‚¤ ì‚¬ìš© - Variant:', variant);
                }
                
                return variant;
            }

            // Variant ì ìš©
            async function applyVariant() {
                const variant = await getVariant();
                console.log('âœ… ì ìš©í•  Variant:', variant);
                
                const lists = document.querySelectorAll('.dtc-dwcr-list');
                console.log('ğŸ“‹ ì°¾ì€ ë¦¬ìŠ¤íŠ¸:', lists.length);
                
                lists.forEach(list => {
                    const listVariant = list.getAttribute('data-variant');
                    console.log(`  - ë¦¬ìŠ¤íŠ¸ Variant: ${listVariant}, ì ìš©í•  Variant: ${variant}`);
                    
                    if (listVariant === variant) {
                        list.style.display = 'grid';
                        console.log(`  âœ… ${listVariant} í‘œì‹œ`);
                    } else {
                        list.style.display = 'none';
                        console.log(`  âŒ ${listVariant} ìˆ¨ê¹€`);
                    }
                });

                const variantEl = document.getElementById('currentVariant');
                if (variantEl) {
                    variantEl.textContent = 'Variant ' + variant;
                }
                
                return variant;
            }

            // í´ë¦­ ë¡œê¹…
            function logClick(elementId, href) {
                const variant = cookies.get('ab_version') || 'A';
                const data = {
                    variant: variant,
                    elementId: elementId,
                    href: href,
                    pagePath: window.location.pathname,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    referrer: document.referrer
                };

                console.log('ğŸ“¤ í´ë¦­ ì „ì†¡:', data);

                fetch(LOG_API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(result => {
                    console.log('âœ… ì €ì¥ ì™„ë£Œ:', result);
                    document.getElementById('apiStatus').textContent = 'âœ… ì„œë²„ì— ì €ì¥ë¨';
                    setTimeout(() => {
                        document.getElementById('apiStatus').textContent = 'ëŒ€ê¸°ì¤‘...';
                    }, 2000);
                })
                .catch(err => {
                    console.error('âŒ ì—ëŸ¬:', err);
                    document.getElementById('apiStatus').textContent = 'âŒ ì €ì¥ ì‹¤íŒ¨';
                });
            }

            // í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
            function attachListeners() {
                const trackedLinks = document.querySelectorAll('a[id^="dtc-dwcr-"]');
                console.log('ğŸ”— ì¶”ì  ë§í¬:', trackedLinks.length + 'ê°œ');
                
                trackedLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        
                        console.log('ğŸ–±ï¸ í´ë¦­:', link.id);
                        logClick(link.id, link.href);
                        
                        // UI ì—…ë°ì´íŠ¸
                        localClickCount++;
                        localStorage.setItem('demo_click_count', localClickCount);
                        document.getElementById('clickCount').textContent = localClickCount;
                        document.getElementById('lastClick').textContent = 
                            'ë§ˆì§€ë§‰: ' + (channelNames[link.id] || link.id);
                        
                        alert(`${channelNames[link.id]} í´ë¦­ë¨!\n(ë°ëª¨ ëª¨ë“œ: ì‹¤ì œ ì´ë™í•˜ì§€ ì•ŠìŒ)\n\nâœ… ì„œë²„ì— ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    });
                });
            }

            // ì „ì—­ í•¨ìˆ˜ë“¤
            window.switchVariant = function(variant) {
                cookies.set('ab_version', variant, 30);
                applyVariant();
                alert('Variant ' + variant + 'ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
            };

            window.resetTest = function() {
                cookies.delete('ab_version');
                localStorage.removeItem('demo_click_count');
                localClickCount = 0;
                location.reload();
            };

            window.viewLogs = async function() {
                try {
                    const response = await fetch(ANALYTICS_API + '?' + new URLSearchParams({
                        startDate: new Date(Date.now() - 7*24*60*60*1000).toISOString().split('T')[0],
                        endDate: new Date().toISOString().split('T')[0],
                        pagePath: '/ob/stella/abtest/ab_test_demo_1031.html'
                    }));
                    
                    const data = await response.json();
                    
                    if (data.logs && data.logs.length > 0) {
                        let logText = `ğŸ“Š í´ë¦­ ë¡œê·¸ (ì´ ${data.summary.totalClicks}ê±´)\n\n`;
                        logText += `Variant A: ${data.summary.variantA}ê±´\n`;
                        logText += `Variant B: ${data.summary.variantB}ê±´\n`;
                        logText += `ìŠ¹ì: ${data.summary.winner}\n\n`;
                        logText += 'ìµœê·¼ 10ê±´:\n';
                        
                        data.logs.slice(0, 10).forEach(log => {
                            logText += `[${log.variant}] ${channelNames[log.elementId] || log.elementId}\n`;
                            logText += `${new Date(log.timestamp).toLocaleString()}\n\n`;
                        });
                        
                        alert(logText);
                        console.table(data.logs);
                    } else {
                        alert('ì €ì¥ëœ ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('ë¡œê·¸ ì¡°íšŒ ì‹¤íŒ¨:', error);
                    alert('ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            };

            // ì´ˆê¸°í™”
            async function init() {
                console.log('ğŸ§ª A/B Test ì´ˆê¸°í™” ì‹œì‘');
                
                // ì¹´ìš´í„° í‘œì‹œ
                document.getElementById('clickCount').textContent = localClickCount;
                
                // Variant ì ìš©
                await applyVariant();
                
                // ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                attachListeners();
                
                document.getElementById('apiStatus').textContent = 'âœ… ì¤€ë¹„ ì™„ë£Œ';
                console.log('âœ… ì´ˆê¸°í™” ì™„ë£Œ');
            }

            // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
</body>
</html>